
<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Agenda.bj</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
           font-family: 'Segoe UI', system-ui, sans-serif;
       }
       body {
           background-color: #121212;
           color: #ffffff;
           display: flex;
           justify-content: center;
           align-items: center;
           min-height: 100vh;
           padding: 20px;
       }
       .chatbot-container {
           width: 100%;
           max-width: 800px;
           background-color: #1e1e1e;
           border-radius: 20px;
           box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
           overflow: hidden;
           display: flex;
           flex-direction: column;
           height: 90vh;
           max-height: 800px;
           border: 1px solid #333;
       }
       /* Header - ROUGE sur fond noir */
       .chat-header {
           background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
           color: white;
           padding: 20px 25px;
           display: flex;
           justify-content: space-between;
           align-items: center;
           border-bottom: 1px solid #333;
       }
       .chat-title {
           display: flex;
           align-items: center;
           gap: 12px;
       }
       .chat-title h1 {
           font-size: 22px;
           font-weight: 600;
       }
       .status {
           display: flex;
           align-items: center;
           gap: 8px;
           font-size: 14px;
           background-color: rgba(255, 255, 255, 0.2);
           padding: 4px 12px;
           border-radius: 20px;
       }
       .status-indicator {
           width: 8px;
           height: 8px;
           background-color: #4cff4c;
           border-radius: 50%;
           animation: pulse 1.5s infinite;
       }
       @keyframes pulse {
           0% { opacity: 1; }
           50% { opacity: 0.5; }
           100% { opacity: 1; }
       }
       .header-actions {
           display: flex;
           gap: 15px;
       }
       .header-actions i {
           font-size: 18px;
           cursor: pointer;
           opacity: 0.8;
           transition: opacity 0.2s;
       }
       .header-actions i:hover {
           opacity: 1;
       }
       /* Chat messages area - FOND NOIR */
       .chat-messages {
           flex: 1;
           padding: 25px;
           overflow-y: auto;
           background-color: #121212;
           display: flex;
           flex-direction: column;
           gap: 20px;
       }
       .message {
           display: flex;
           max-width: 80%;
           animation: fadeIn 0.3s ease-out;
       }
       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(10px); }
           to { opacity: 1; transform: translateY(0); }
       }
       .user-message {
           align-self: flex-end;
           flex-direction: row-reverse;
       }
       .bot-message {
           align-self: flex-start;
       }
       .message-content {
           padding: 14px 18px;
           border-radius: 18px;
           font-size: 15px;
           line-height: 1.5;
           position: relative;
           white-space: pre-wrap;
       }
       /* Message utilisateur en ROUGE */
       .user-message .message-content {
           background-color: #d32f2f;
           color: white;
           border-bottom-right-radius: 5px;
       }
       /* Message bot sur fond noir */
       .bot-message .message-content {
           background-color: #2d2d2d;
           color: #ffffff;
           border-bottom-left-radius: 5px;
           box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
           border: 1px solid #444;
       }
       .message-avatar {
           width: 36px;
           height: 36px;
           border-radius: 50%;
           display: flex;
           align-items: center;
           justify-content: center;
           margin: 0 10px;
           flex-shrink: 0;
       }
       .user-message .message-avatar {
           background-color: #f44336;
           color: white;
       }
       /* Avatar bot en ROUGE */
       .bot-message .message-avatar {
           background-color: #d32f2f;
           color: white;
       }
       .message-time {
           font-size: 11px;
           color: #aaa;
           margin-top: 5px;
           text-align: right;
       }
       .user-message .message-time {
           text-align: right;
       }
       .bot-message .message-time {
           text-align: left;
       }
       /* Chat input - FOND NOIR */
       .chat-input-container {
           padding: 20px 25px;
           border-top: 1px solid #333;
           background-color: #1e1e1e;
           position: relative;
       }
       .chat-input-wrapper {
           display: flex;
           align-items: center;
           background-color: #2d2d2d;
           border-radius: 30px;
           padding: 5px 5px 5px 20px;
           border: 1px solid #444;
       }
       /* Focus en ROUGE */
       .chat-input-wrapper:focus-within {
           border-color: #d32f2f;
           box-shadow: 0 0 0 2px rgba(211, 47, 47, 0.3);
       }
       #user-input {
           flex: 1;
           border: none;
           background: transparent;
           padding: 12px 10px;
           font-size: 15px;
           color: #ffffff;
           outline: none;
       }
       #user-input::placeholder {
           color: #888;
       }
       /* Bouton en ROUGE */
       .send-button {
           background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
           color: white;
           border: none;
           width: 44px;
           height: 44px;
           border-radius: 50%;
           display: flex;
           align-items: center;
           justify-content: center;
           cursor: pointer;
           transition: transform 0.2s;
       }
       .send-button:hover {
           transform: scale(1.05);
       }
       .input-actions {
           display: flex;
           gap: 15px;
           margin-top: 15px;
           flex-wrap: wrap;
       }
       /* Chips en ROUGE sur fond noir */
       .action-chip {
           background-color: #2d2d2d;
           color: #ff6b6b;
           padding: 8px 16px;
           border-radius: 20px;
           font-size: 14px;
           cursor: pointer;
           transition: all 0.2s;
           border: 1px solid #444;
       }
       .action-chip:hover {
           background-color: #d32f2f;
           color: white;
           transform: translateY(-2px);
           border-color: #d32f2f;
       }
       /* Integration section - FOND NOIR */
       .integration-section {
           padding: 20px 25px;
           background-color: #1e1e1e;
           border-top: 1px solid #333;
       }
       .integration-section h3 {
           font-size: 16px;
           color: #ddd;
           margin-bottom: 12px;
           display: flex;
           align-items: center;
           gap: 8px;
       }
       .integration-item {
           display: flex;
           align-items: center;
           justify-content: space-between;
           padding: 15px;
           background-color: #2d2d2d;
           border-radius: 12px;
           margin-bottom: 10px;
           border: 1px solid #444;
           transition: all 0.2s;
           cursor: pointer;
       }
       .integration-item:hover {
           transform: translateY(-3px);
           box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
           border-color: #d32f2f;
       }
       .integration-info {
           display: flex;
           align-items: center;
           gap: 12px;
       }
       /* Ic√¥ne d'int√©gration en ROUGE */
       .integration-icon {
           width: 40px;
           height: 40px;
           background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
           border-radius: 10px;
           display: flex;
           align-items: center;
           justify-content: center;
           color: white;
           font-size: 18px;
       }
       .integration-details h4 {
           font-size: 15px;
           margin-bottom: 4px;
           color: #fff;
       }
       .integration-details p {
           font-size: 13px;
           color: #bbb;
       }
       /* Action d'int√©gration en ROUGE */
       .integration-action {
           color: #ff6b6b;
           font-size: 14px;
           font-weight: 600;
       }
       /* Responsive */
       @media (max-width: 768px) {
           .chatbot-container {
               height: 95vh;
               border-radius: 15px;
           }
           .chat-messages {
               padding: 15px;
           }
           .message {
               max-width: 90%;
           }
           .chat-header, .chat-input-container, .integration-section {
               padding: 15px;
           }
       }
       @media (max-width: 480px) {
           .chat-title h1 {
               font-size: 18px;
           }
           .message-content {
               font-size: 14px;
               padding: 12px 16px;
           }
           .input-actions {
               flex-wrap: wrap;
           }
       }
       /* Scrollbar pour fond noir */
       ::-webkit-scrollbar {
           width: 8px;
       }
       ::-webkit-scrollbar-track {
           background: #2d2d2d;
           border-radius: 10px;
       }
       ::-webkit-scrollbar-thumb {
           background: #555;
           border-radius: 10px;
       }
       ::-webkit-scrollbar-thumb:hover {
           background: #777;
       }
       /* Loading indicator en ROUGE */
       .loading {
           display: inline-block;
           width: 20px;
           height: 20px;
           border: 2px solid #444;
           border-top: 2px solid #d32f2f;
           border-radius: 50%;
           animation: spin 1s linear infinite;
           margin-right: 10px;
       }
       @keyframes spin {
           0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
       }
       /* Style pour les liens dans les messages */
       .message-content a {
           color: #ff6b6b;
           text-decoration: none;
       }
       .message-content a:hover {
           text-decoration: underline;
       }
</style>
</head>
<body>
<div class="chatbot-container">
<!-- Header -->
<div class="chat-header">
<div class="chat-title">
<div class="status">
<div class="status-indicator"></div>
<span>Online</span>
</div>
<h1>Agenda.bj Chat</h1>
</div>
<div class="header-actions">
<i class="fas fa-expand-alt" title="Agrandir"></i>
<i class="fas fa-cog" title="Param√®tres"></i>
<i class="fas fa-times" title="Fermer"></i>
</div>
</div>
<!-- Chat messages -->
<div class="chat-messages" id="chat">
<!-- Messages will be added here dynamically -->
<div class="message bot-message">
<div class="message-avatar">
<i class="fas fa-robot"></i>
</div>
<div>
<div class="message-content">
                       Bonjour! Je suis l'assistant de l'Agenda.bj. Comment puis-je vous aider aujourd'hui?
</div>
<div class="message-time" id="initial-time">10:00</div>
</div>
</div>
</div>
<!-- Integration section (optional) -->
<div class="integration-section">
<h3><i class="fas fa-puzzle-piece"></i> Int√©grations</h3>
<div class="integration-item">
<div class="integration-info">
<div class="integration-icon">
<i class="fas fa-calendar-alt"></i>
</div>
<div class="integration-details">
<h4>Agenda.bj API</h4>
<p>Acc√®s aux donn√©es d'√©v√©nements et calendriers du B√©nin</p>
</div>
</div>
<div class="integration-action">En savoir plus</div>
</div>
</div>
<!-- Chat input -->
<div class="chat-input-container">
<div class="chat-input-wrapper">
<input
                   type="text"
                   id="user-input"
                   placeholder="√âcrivez un message..."
                   autocomplete="off"
                   onkeydown="if(event.key==='Enter') sendMessage()"
               />
<button class="send-button" id="send-button" onclick="sendMessage()">
<i class="fas fa-paper-plane"></i>
</button>
</div>
<div class="input-actions">
<div class="action-chip" data-message="Quels √©v√©nements sont pr√©vus aujourd'hui?">üìÖ √âv√©nements du jour</div>
<div class="action-chip" data-message="Comment utiliser Agenda.bj?">‚ùì Aide</div>
<div class="action-chip" data-message="Quelles sont les actualit√©s culturelles?">üé≠ Culture</div>
<div class="action-chip" data-message="Merci!">üôè Merci</div>
</div>
</div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const chatInput = document.getElementById('user-input');
        const chatMessages = document.getElementById('chat');
        const actionChips = document.querySelectorAll('.action-chip');

        // Initialiser l'heure
        const now = new Date();
        const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        document.getElementById('initial-time').textContent = timeString;

        // --- FONCTION DE RENDU AM√âLIOR√âE (Markdown to HTML) ---
        function formatMarkdown(text) {
            let html = text
                // 1. D√©tecter les images ![alt](url)
                .replace(/!\[.*?\]\((.*?)\)/g, '<img src="$1" style="max-width:100%; border-radius:12px; margin: 10px 0; display:block; border: 1px solid #444; box-shadow: 0 4px 12px rgba(0,0,0,0.5);">')
                // 2. D√©tecter les liens [texte](url)
                .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" style="color: #ff6b6b; font-weight: bold; text-decoration: underline;">$1</a>')
                // 3. D√©tecter le gras **texte**
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // 4. D√©tecter les retours √† la ligne
                .replace(/\n/g, '<br>');
            return html;
        }

        function appendMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type === 'user' ? 'user-message' : 'bot-message'}`;
            
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            const avatarIcon = type === 'user' ? 'fa-user' : 'fa-robot';

            // On utilise formatMarkdown ici pour transformer le texte re√ßu
            const contentHTML = formatMarkdown(text);

            messageDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas ${avatarIcon}"></i>
                </div>
                <div>
                    <div class="message-content">${contentHTML}</div>
                    <div class="message-time">${timeString}</div>
                </div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showLoading() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot-message';
            loadingDiv.id = 'loading-message';
            loadingDiv.innerHTML = `
                <div class="message-avatar"><i class="fas fa-robot"></i></div>
                <div>
                    <div class="message-content"><div class="loading"></div> En cours de r√©flexion...</div>
                </div>
            `;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeLoading() {
            const loadingDiv = document.getElementById('loading-message');
            if (loadingDiv) loadingDiv.remove();
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const msg = input.value.trim();
            if (!msg) return;

            appendMessage(msg, 'user');
            input.value = '';
            showLoading();

            try {
                const res = await fetch('/chat/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: msg })
                });

                removeLoading();

                if (res.ok) {
                    const data = await res.json();
                    appendMessage(data.reply, 'bot');
                } else {
                    appendMessage("‚ùå Erreur de r√©ponse du serveur.", 'bot');
                }
            } catch (e) {
                removeLoading();
                appendMessage("üåê Probl√®me de connexion au serveur.", 'bot');
                console.error("Erreur:", e);
            }
        }

        // Chips d'action rapide
        actionChips.forEach(chip => {
            chip.addEventListener('click', function() {
                chatInput.value = this.getAttribute('data-message');
                sendMessage();
            });
        });

        // Expand/Collapse
        document.querySelector('.fa-expand-alt').addEventListener('click', function() {
            const container = document.querySelector('.chatbot-container');
            if (container.style.height === '100vh') {
                container.style.height = '90vh';
                container.style.maxHeight = '800px';
            } else {
                container.style.height = '100vh';
                container.style.maxHeight = 'none';
            }
        });

        window.sendMessage = sendMessage;
    });
</script>       
         
</body>
</html>
